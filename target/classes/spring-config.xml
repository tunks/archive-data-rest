<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xmlns:mongo="http://www.springframework.org/schema/data/mongo"
       xmlns:redis="http://www.springframework.org/schema/redis"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util" 
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
  http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.2.xsd
  http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
  http://www.springframework.org/schema/data/mongo
  http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
  http://www.springframework.org/schema/redis 
  http://www.springframework.org/schema/redis/spring-redis.xsd">

    <context:component-scan base-package="com.att.archive.restful.controller" />
     <mvc:annotation-driven>
      <mvc:argument-resolvers>
         <bean class="org.springframework.data.web.PageableHandlerMethodArgumentResolver" />
      </mvc:argument-resolvers>
    </mvc:annotation-driven>
 
     <!-- service beans -->
    <bean id="archiveService" class="com.att.archive.restful.service.ArchiveService" />
    
    <bean id="archiveFactory" class="com.att.archive.restful.service.DataArchiveFactory"/>
    <bean id="archiver" class="com.att.archive.restful.util.DataArchiver"/>
    <!-- mongodb configuration -->
<!--    <mongo:mongo id="mongo" />-->
    <!-- <mongo:db-factory host="localhost" port="27017" dbname="test" />  -->
    <bean id="mongoClient" class="org.springframework.data.mongodb.core.MongoFactoryBean">
        <property name="host" value="storage.etunkara.info" />
        <property name="port" value="27017" />
    </bean>
    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongo" ref="mongoClient"  />
        <constructor-arg value="archivedb" />
        <!-- <constructor-arg name="mongoDbFactory" ref="mongoDbFactory"/> -->
    </bean>
    <mongo:repositories base-package="com.att.archive.restful.repositories" />
    <!-- redis connection configuration -->
    <bean id="jedisConnectionFactory" 
        class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory" 
        p:host-name="storage.etunkara.info" 
        p:port="16379" />
     <!--redis template definition -->
    <bean id="redisTemplate" class="org.springframework.data.redis.core.RedisTemplate" p:connection-factory-ref="jedisConnectionFactory"/>
  
    <bean id="messageListener" class="org.springframework.data.redis.listener.adapter.MessageListenerAdapter">
        <constructor-arg>
            <bean class="com.att.archive.restful.message.ArchiveMessageDelegate" />
        </constructor-arg>
    </bean>

    <bean id="redisContainer" class="org.springframework.data.redis.listener.RedisMessageListenerContainer">
        <property name="connectionFactory" ref="jedisConnectionFactory"/>
        <property name="messageListeners">
            <map>
                <entry key-ref="messageListener">
                    <bean class="org.springframework.data.redis.listener.PatternTopic">  <!--org.springframework.data.redis.listener.ChannelTopic"> -->
                        <constructor-arg value="raptor:messages:archives*" />
                    </bean>
                </entry>
            </map>
        </property>
    </bean>
</beans>
